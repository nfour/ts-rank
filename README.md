# ts-rank

A quick n simple CLI to rank output from TypeScript@4.1's `compilerOptions.generateTrace` option.

So you can discover where slow types are hiding.

Will output a set of ranked lists, for metrics:
- [x] `StructuredTypeCheck`

Intend to support type alises & other metrics, though for now `StructuredTypeCheck` seems to be the most relevant.

+ [Run ts-rank](#run-ts-rank)
+ [Example package.json scripts](#example-packagejson-scripts)
+ [Configure through tsconfig.json](#configure-through-tsconfigjson)
+ [Configure through fork-ts-checker-webpack-plugin](#configure-through-fork-ts-checker-webpack-plugin)

## Run ts-rank

```
npx ts-rank
```

Outputs:

```bash
ts-rank

Ranking output from 'tsconfig.compilerOptions.generateTrace'
  {
    logCount: 5,
    traceFile: '~/.tsTrace/trace.json',
    typesFile: '~/.tsTrace/types.json',
    pattern: '**/*',
    cwd: '~/ts-rank'
  }
  
  :: Reading files: 147.192ms
  :: 72627 traces, 30455 types
  
  'StructuredTypeCheck' source:
    1.      400 ms < __object                       > tsRank.ts:14:12
    2.      328 ms < __object                       > tsRank.ts:14:12
    3.      150 ms < __function                     > tsRank.ts:120:36
    4.      139 ms < __function                     > tsRank.ts:140:64
    5.       80 ms < __function                     > tsRank.ts:140:30
    
  
  'StructuredTypeCheck' node_modules:
    1.    76755 ms < ObjectChain                    > node_modules/@types/lodash/common/common.d.ts:205:6
    2.    76054 ms < entries                        > node_modules/@types/lodash/common/object.d.ts:599:31
    3.    75585 ms < CollectionChain                > node_modules/@types/lodash/common/common.d.ts:181:6
    4.    75234 ms < CollectionChain                > node_modules/@types/lodash/common/common.d.ts:181:6
    5.    74964 ms < pop                            > node_modules/@types/lodash/common/common.d.ts:182:35
    
  :: T: 196.840ms

Done in 5.03s.
```

```bash
> npx ts-rank --help 

ts-rank

Options:
  --version    Show version number                                     [boolean]
  --logCount                                              [number] [default: 10]
  --traceFile                        [string] [default: "./.tsTrace/trace.json"]
  --typesFile                        [string] [default: "./.tsTrace/types.json"]
  --pattern    Ruduce the ranking to files that match this glob         [string]
```

```bash
# Provide location to the trace files generated by generateTrace
npx ts-rank --traceFile trace/trace.json --typesFile trace/types.json

# Use --pattern as a glob to filter rankings based on file path
npx ts-rank --pattern "**/someFolder/**"  
```

## Example package.json scripts

```json
{
  "scripts": {
    "trace": "tsc --noEmit --generateTrace .tsTrace && npx ts-rank",
    "trace:full": "tsc --noEmit --incremental false --generateTrace .tsTrace && npx ts-rank",
  }
}
```

## Configure through tsconfig.json

```json
{
  "compilerOptions": {
    // The folder where the traces go
    "generateTrace": "./.tsTrace",

    // Disable this to get a full trace
    "incremental": false
  }
}
```

Also works with `fork-ts-checker-webpack-plugin`. Try using the `configOverwites` option when configuring the webpack plugin.

## Configure through fork-ts-checker-webpack-plugin

```ts
const isTracingTs = true
const isTracingTsFully = true

new TsPlugin({
  build: false,
  typescript: {
    configOverwrite: {
      compilerOptions: {
        // Making all of this optional with these booleans.
        ...(isTracingTs
          ? {
              generateTrace: './.tsTrace/trace',
              ...(isTracingTsFully ? { incremental: false } : {}),
            }
          : {}),
      },
    },
  },
}),
```
